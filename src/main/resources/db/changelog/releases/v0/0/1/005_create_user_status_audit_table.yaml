databaseChangeLog:
  - changeSet:
      id: create_user_status_audit_table
      author: Aleksandr
      changes:
        - createTable:
            tableName: user_status_audit
            schemaName: public
            columns:
              - column:
                  name: audit_id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: old_status
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: new_status
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: changed_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: reason
                  type: VARCHAR(500)
        - addForeignKeyConstraint:
            baseTableName: user_status_audit
            baseColumnNames: user_id
            referencedTableName: user
            referencedColumnNames: user_id
            constraintName: user_status_audit_fk_user
            onDelete: RESTRICT

  - changeSet:
      id: add_user_status_audit_indexes
      author: Aleksandr
      changes:
        - createIndex:
            indexName: idx_user_status_audit_user
            tableName: user_status_audit
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_user_status_audit_timestamp
            tableName: user_status_audit
            columns:
              - column:
                  name: changed_at